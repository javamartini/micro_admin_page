<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>MicroNetwork Status</title>
	<link rel="stylesheet" type="text/css" href="../css/style.css"/>
</head>
<body style="padding: 0">
<!-- navbar -->
<nav class="navbar">
	<div class="nav" id="navbar">
		<a href="./micro8deb_admin.html">micro8deb</a>
		<a href="./raspberrypi5_admin.html">raspberrypi5</a>
		<a href="./status.html" class="active">Overall Status</a>
		<a href="https://weather.micro8deb.com">
			<img src="../icons/arrow-up-right-from-square-solid.svg" alt="external link icon"
				 style="width: 16px; height: 16px; margin-right: 5px; filter: invert(1);"/>
			Micro Weather Service</a>
		<a href="./login.html">
			<img src="../icons/arrow-up-right-from-square-solid.svg" alt="external link icon"
				 style="width: 16px; height: 16px; margin-right: 5px; filter: invert(1);"/>
			Log Out</a>
		<a href="javascript:void(0);" class="icon" onclick="responsiveNavbar()">
			<i><img src="../icons/bars-solid.svg" alt="extend menu icon"
					style="width: 16px; height: 16px; filter: invert(1);"/></i>
		</a>
	</div>
</nav>
<script>
	document.querySelector("#DOMContentLoaded").addEventListener("DOMContentLoaded", function () {
		let strToken = localStorage.getItem("jwt_token");
		//if the token is null, and they somehow got this far, redirect them to login
		if (!strToken) {
			window.location.href = "./login.html";
			//else, fetch endpoint and it's headers
		} else {
			fetch("http://localhost:8080/status", {
				method: "GET",
				headers: {
					"Content-Type": "application/json",
					"Authorization": `Bearer ${strToken}`
				}
			}).then(response => {
				//if the response is not ok, throw the error
				if (!response.ok) {
					throw new Error("NETWORK RESPONSE WAS NOT OK");
					//else, return the response in the form of a JSON
				} else {
					return response.json();
				}
				//if there was a critical network error, redirect the user and let them know
			}).catch(error => {
				console.error("Error:", error);
				window.location.href = "./login.html";
			});
		}
	});

	function responsiveNavbar() {
		let navNavBar = document.getElementById("navbar");
		//if navbar has class nav, add the responsive class
		if (navNavBar.className === "nav") {
			navNavBar.className += " responsive";
			//if navbar does not have class nav, leave it alone
		} else {
			navNavBar.className = "nav";
		}
	}
</script>
</body>
</html>